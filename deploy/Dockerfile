FROM node:12.19.0-alpine3.9

ARG NODE_ENV=production
ENV NODE_ENV=$NODE_ENV

ARG COUCHDB_URL
ENV COUCHDB_URL=$COUCHDB_URL

ARG COUCHDB_USER
ENV COUCHDB_USER=$COUCHDB_USER

ARG COUCHDB_PASSWORD
ENV COUCHDB_PASSWORD=$COUCHDB_PASSWORD

WORKDIR "/app"

RUN apk add git
COPY package.json yarn.lock ./
RUN yarn install --production

COPY dist/apps/api ./

CMD ["node", "main"]
